<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Pyxel Save Demo</title>
    <script src="https://cdn.jsdelivr.net/gh/kitao/pyxel/wasm/pyxel.js"></script>
  </head>
  <body>
    <pyxel-run src="main.py"></pyxel-run>

    <script>
      let pyxelFrame = document.querySelector("pyxel-run");

      // 出力監視（セーブ・ロード用）
      pyxelFrame.addEventListener("stdout", (event) => {
        let output = event.detail.trim();
        if (output.startsWith("SAVE:")) {
          let score = output.split(":")[1];
          localStorage.setItem("myPyxelSave", score);
          alert("スコアを保存しました！");
        } else if (output === "LOAD") {
          let savedScore = localStorage.getItem("myPyxelSave") || "0";
          // Pythonに再表示させるための "LOAD:<score>" を入力として送る
          pyxelFrame.stdin = `LOAD:${savedScore}\n`;
        }
      });

      // Pythonから受け取ったLOAD:<score> を再出力するようにPython側を少し工夫すると、
      // scoreの上書きも可能になる（続きで説明するね）
    </script>
  </body>
</html>
